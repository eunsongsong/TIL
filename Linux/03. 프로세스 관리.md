[TOC]

### 03. 프로세스 관리

#### 3-1. 프로세스의 개요

##### 프로세스 (process)

- 프로세스는 CPU와 메모리를 할당받아 실행시키는 프로그램
- 프로세스들마다 고유의 프로세스 ID(PID)를 할당받음
- 리눅스가 부팅을 시작하면 커널은 init 프로세스라는 최초의 프로세스를 발생시키고, PID 1번을 할당 받음
- suspend : 메모리에 탑재되어 작업 중인 프로세스를 일시적으로 중지시키는 것 

##### 포그라운드 프로세스 (Foreground)

- 사용자와 상호작용하는 프로세스
- 명령 입력 후 수행 종료까지 기다려야 하는 프로세스

##### 백그라운드 프로세스 (Background)

- 사용자의 입력에 관계없이 실행되는 프로세스
- 기존의 포그라운드 프로세스 실행 명령 뒤에 __&__ 만 추가로 붙여서 싱행하면 됨
- 다중 작업을 수행할 때 유용

##### fork()

- 새로운 프로세스를 만들 때 기존 프로세스를 복제하는 방식
- 새로운 프로세스를 위한 메모리 할당
- 새로 생성된 프로세스는 원래의 프로세스와 똑같은 코드를 가지고 있고, 기존 프로세스는 그대로 실행되어 있음

##### exec()

- 호출하는 프로세스가 새로운 프로세스로 변경되는 방식
- 새로운 프로세스를 위한 메모리를 할당하지 않음
- 호출한 프로세스의 메모리에 새로운 프로세스의 코드를 덮어씌움

##### 작업 전환

- 포그라운드 프로세스 → 백그라운드 프로세스 : `ctrl`+`z` 를 눌러 대기 상태로 만들고, `bg`라를 명령을 입력하면 백그라운드 프로세스로 전환됨

- 백그라운드 프로세스 → 포그라운드 프로세스 : `fg %작업번호` 를 입력, 작업번호는 `jobs` 라는 명령어로 확인 가능



#### 3-2. 시그널과 데몬

##### 시그널

- 신호라는 의미로 리눅스에서는 프로세스끼리 서로 통신할 때 사용

- 특정 프로세스가 다른 프로세스에게 메세지를 보낼 때 사용

| 번호 | 이름    | 내용                                       |
| ---- | ------- | ------------------------------------------ |
| 1    | SIGHUP  | 터미널과 연결이 끊어졌을 때 종료 후 재시작 |
| 2    | SIGINT  | `ctrl`+`C` 입력 시 종료                    |
| 3    | SIGQUIT | `ctrl`+`\` 입력 시 코어덤프                |
| 9    | SIGKILL | 프로세스 강제 종료 시 종료                 |
| 15   | SIGTERM | Kill 시스템 호출 시 종료                   |
| 18   | SIGCONT | 중지된 프로세스 실행 시 무시               |
| 19   | SIGSTOP | SIGCONT 시그널을 받을 때까지 종료          |
| 20   | SIGTSTP | `ctrl`+`Z` 입력 시 프로세스 대기로 전환    |

##### 데몬

- 주기적이고 지속적인 서비스 요청을 처리하기 위해 계속 실행되는 프로세스로 백그라운드로 실행

- 리눅스에서는 서버 역할을 하는 프로그램들이 이에 해당

- 보통 이름 뒤에 데몬을 뜻하는 `d` 를 붙임

- standalone : 보통 부팅 시에 실행되어 해당 프로세스가 메모리에 계속 상주하면서 클라이언트의 서비스 요청을 처리하는 방식

  (웹, 메일 등과 같이 빈번한 요청이 들어오는 서비스에 주로 이용)

- inet : 프로세스가 메모리에 항상 상주하는 것이 아니라, 클라이언트의 서비스 요청이 들어왔을 때 관련 프로세스를 싱행 시키고 접속 종료 후에는 자동으로 프로세스를 종료

  (커널 2.4 버전 부터는 inetd의 역할을 확장하여 새롭게 만든 xinetd 데몬이 이 역할을 수행)



#### 3-3. 프로세스의 명령어 및 유틸리티

##### ps (process status)

- 동작 중인 프로세스의 상태를 출력하는 명령
- __ps aux__ : 시스템에 동작 중인 모든 프로세스 소유자 정보와 함께 출력

| 항목 | 의미                                                  |
| ---- | ----------------------------------------------------- |
| USER | BSD 계열에서 나타나는 항목으로 프로세스 사용자의 이름 |
| VSZ  | K 단위, 페이지 단위의 가상 메모리 사용량              |
| RSS  | 실제 메모리 사용량 (Resident Set Size)                |
| TTY  | 프로세스와 연결된 터미널                              |
| STAT | 현재 프로세스의 상태 코드                             |
| TIME | 총 CPU 사용 시간                                      |
| PPID | 부모 프로세스의 PID                                   |
| PID  | 프로세스읭 식별 번호                                  |
| PRI  | 실제 실행 우선순위                                    |

| 프로세스 STAT의 주요 값 | 의미                                                         |
| ----------------------- | ------------------------------------------------------------ |
| R                       | 실행중 혹은 실행될 수 있는 상태                              |
| S                       | SLEEP 상태로 특정 이벤트가 끝나길 기다림                     |
| D                       | 디스크 I/O 에 의해 대기하고 있는 상태                        |
| T                       | 정지된 상태 (suspend)                                        |
| Z                       | 좀비 프로세르, 작업이 종료되었으나 부모 프로세스로부터 회수되지 않아 메모리를 차지하고 있는 상태 |

##### pstree

프로세스의 상태를 트리 구조로 출력해주는 명령

| 옵션 | 내용                                    |
| ---- | --------------------------------------- |
| -a   | 각 프로세스의 명령행 인자까지 보여줌    |
| -h   | 실행한 명령 부분을 진하게 강조해서 출력 |

##### top

동작 중인 프로세스의 상태를 실시간으로 화면에 출력 (CPU, 메모리, 부하 상태)

##### kill

- 프로세스에 시그널을 보내는 명령으로 옵션 없이 실행하면 프로세스에 종료 신호 15, SIGTERM으로 보냄

- 보통 중지시킬 수 없는 프로세스를 종료시킬 때 사용

| 옵션                            | 설명                        |
| ------------------------------- | --------------------------- |
| -l                              | 시그널 종류 나열            |
| -s 시그널 번호 또는 -s 시그널명 | 전달할 시그널의 종류를 지정 |
| -1                              | -HUP, 프로세스 재시작       |
| -9                              | 프로세스를 강제로 종료      |

##### killall

같은 데몬의 여러 프로세스를 한번에 종료시킬 때 사용

##### nice

- 프로세스의 우선순위 변경
- NI(우선순위)의 기본값은 0이며, `-20` ~ `19` 범위를 갖음 (값이 작을수록 우선순위가 높음)

- 일반 사용자는 nice 값을 증가시킬 수만 있음

- root는 nice 값을 감소시켜 우선순위를 높일 수 있음

- 명령어 `nice -10 bash` 는 프로세스의 NI 값을 10만큼 증가시키는 것이며 값이 증가한다는 것은 우선순위를 낮춤

  우선순위를 높이는 명령어는 `nice --10 bash` 으로 NI 값을 -10만큼 감소시켜 우선순위를 높임

##### renice

- 이미 실행 중인 프로세스의 우선순위를 변경
- 우선순위 변경 시 프로세스 ID, 사용자 이름, 그룹 ID를 사용

- nice는 기존 NI 값을 증감시키지만 renice는 지정한 NI 값을 설정

- root만이 NI 값을 감소시켜 우선순위를 높일 수 있음

- NI 값의 범위는 `-20` ~ `19`

- nice는 양수값에 `-` , 음수값에 `--` 를 사용하지만, renice는 양수값에 `-` 를 사용하지 않음

  `renice -20 3241` 는 프로세스 3241의 NI 값을 `-20` 으로 변경

##### nohup

- 사용자가 로그아웃하거나 작업 중인 터미널창이 닫혀도 실행중이 프로세스를 백그라운드 프로세스로 작업될 수 있도록 해줌

- 실행한 명령을 자동으로 백그라운드로 보내지 않고, 사용자가 명령행 뒤에 &를 명시해야 함

##### 스케줄링

- 특정한 시간에 특정한 작업을 수행하는 것으로 `at`과 `cron`을 사용
- `at`은 주로 한번만 실행할 때, `cron`은 주기적으로 프로세스를 실행할 때 사용
- __cron__ : 시스템 운영에 필요한 작업은 root 권한으로 `/etc/crontab` 에 등록해서 주기적으로 수행할 수 있고, 사용자는 `crontab`이라는 명령을 수행해서 등록할 수 있음

| crontab 명령어 옵션 | 설명                       |
| ------------------- | -------------------------- |
| -l                  | crontab에 설정된 내용 출력 |
| -e                  | crontab을 작성하거나 수정  |
| -r                  | crontab 내용 삭제          |
| -u                  | 특정 사용자의 일정 수정    |

###### crontab 설정 예제

###### `*`     `*`     `*`     `*`     `*`

첫 번째 `*` : minutes (0-59)

두 번째 `*` : hours (0-23)

세 번째 `*` : day of month (1-31)

네 번째 `*` : month (1-12)

다섯 번째 `*` : day of week (0-6)

```b
10 1 1 1-12/2 * /home/song
```

> 1월 부터 12월 까지 2개월 마다 1일 오전 1시 10분에 실행
>
> 실행 파일의 경로 : /home/song

```bash
0 4 * * 1,3,5 /home/song
```

> 월, 수, 금 오전 4시에 실행
>
> 실행 파일의 경로 : /home/song

